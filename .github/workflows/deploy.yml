name: Deploy con ARC

on:
  push:
    branches: [semana0601]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: mi-runners  # Usa tus runners de ARC
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v4
      
    - name: Ver info del runner
      run: |
        echo "ğŸƒâ€â™‚ï¸ EjecutÃ¡ndose en runner ARC"
        echo "Hostname: $(hostname)"
        echo "Usuario: $(whoami)"
        kubectl version --client
        
    - name: Verificar cluster
      run: |
        echo "ğŸ” Verificando conexiÃ³n a Kubernetes..."
        kubectl get nodes
        kubectl get namespaces
        
    - name: Aplicar manifiestos
      run: |
        echo "ğŸš€ Desplegando aplicaciÃ³n..."
        kubectl apply -f k8s/deployment.yaml
        kubectl apply -f k8s/service.yaml
        
    - name: Esperar despliegue
      run: |
        echo "â³ Esperando que el despliegue estÃ© listo..."
        kubectl rollout status deployment/arc-demo-app --timeout=300s
        
    - name: Verificar resultado
      run: |
        echo "âœ… Estado final:"
        kubectl get pods -l app=arc-demo
        kubectl get service arc-demo-service
        echo ""
        echo "ğŸŒ AplicaciÃ³n disponible en:"
        echo "http://localhost:30080 (si tienes port-forward)"
